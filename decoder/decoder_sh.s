global _start

section .text
_start:
    jmp     decoder
    
encoded:
    db      0x29, 0x50, 0xa1, 0x29, 0x50, 0x9e, 0x29, 0x50, 0xb3, 0xd9, 0x0e, 0x13, 0x0d, 0x05, 0x31, 0x29, 0xd9, 0x29, 0x04, 0x0d, 0x0d, 0x0e, 0x4d, 0x41, 0x36, 0x31, 0x29, 0x50, 0xa1, 0x21, 0xd6, 0x60, 0x29, 0xe8, 0x87, 0xd3, 0x6d, 0xd1, 0x60, 0x6e, 0x64, 0x29, 0x50, 0x9e, 0xd1, 0x5d, 0x6e, 0x64                ; position important to evade null bytes

decoder:
    xor     rsi, rsi
    lea     rdi, [rel encoded]     ; this comes after data for "negative" rel
decode:
    mov     al, [rdi+rsi]
    cmp     al, 0xff               ; end byte
    je      exec
    xor     al, 0x61               ; key
    mov     [rdi+rsi], al
    inc     rsi
    jmp     decode
    
exec:
    jmp     rdi

